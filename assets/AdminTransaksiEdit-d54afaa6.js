import{f as Q,q as X,i as S,r as d,s as Z,a as aa,o as u,c as m,b as a,t as v,u as i,g as _,e as c,n as k,w as E,j as F,v as ea,F as ta,T as g,p as sa,l as na,m as R,_ as N}from"./index-85076a8c.js";import{F as la}from"./FungsiCampur-1f52fc3b.js";import{A as I}from"./axios-526409ed.js";import{F as w,f as C,a as oa}from"./babengValidasi-33405028.js";import{m as $,l as ia}from"./id-225c17f7.js";import{u as ra}from"./dataProfile-4b1b7f2c.js";import{_ as da}from"./_plugin-vue_export-helper-c27b6911.js";const p=x=>(sa("data-v-3245f71b"),x=x(),na(),x),ua={class:"pt-4 px-5 md:flex justify-between items-center border-b pb-4 bg-base-200"},ma=p(()=>a("h1",{class:"text-2xl sm:text-3xl font-extrabold text-base-content uppercase"}," âœï¸ EDIT TRANSAKSI ",-1)),ca={class:"text-sm text-gray-500"},pa={class:"md:py-0 py-4 space-x-2 space-y-2"},va=p(()=>a("i",{class:"fas fa-arrow-left mr-2"},null,-1)),ga={key:0},_a={key:1},ba={key:2},fa={class:"w-full py-6 flex justify-center"},ka={class:"tabs tabs-boxed bg-base-300"},xa={key:0,class:"px-4 py-4 max-w-4xl mx-auto"},ha={class:"w-full"},ya={class:"shadow-xl rounded-lg p-6 bg-base-100"},Da={class:"grid md:grid-cols-2 gap-4"},Pa=p(()=>a("label",{for:"tgl",class:"label"},[a("span",{class:"label-text text-base-content"},[_("Tanggal Transaksi "),a("span",{class:"text-error"},"*")])],-1)),wa={class:"text-xs text-error mt-1"},ja={for:"kategori",class:"label"},Va=p(()=>a("span",{class:"label-text text-base-content"},[_("Kategori "),a("span",{class:"text-error"},"*")],-1)),Aa={key:0,class:"label-text-alt text-primary"},Sa={class:"text-xs text-error mt-1"},Ia=p(()=>a("label",{for:"nominal",class:"label"},[a("span",{class:"label-text text-base-content"},[_("Jumlah / Nominal (IDR) "),a("span",{class:"text-error"},"*")])],-1)),Ta={class:"text-xs text-error mt-1"},Ka={class:"md:col-span-2"},Ea=p(()=>a("label",{for:"nama",class:"label"},[a("span",{class:"label-text text-base-content"},"Keterangan")],-1)),Fa={class:"text-xs text-error mt-1"},Ra={class:"w-full flex justify-end mt-8"},Na=["disabled"],Ca={key:0,class:"flex items-center"},$a=p(()=>a("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1)),La={key:1,class:"flex items-center"},Ma=p(()=>a("i",{class:"fas fa-save mr-2"},null,-1)),Ua={__name:"AdminTransaksiEdit",setup(x){$.updateLocale("id",ia);const j=Q(),L=X(),M=ra(),V=S(()=>M.getData),r=S(()=>V.value&&V.value.username==="admin"),b={label:"kantor",id:18},U=R(()=>N(()=>import("./AlertLoading-7fa38f04.js"),["assets/AlertLoading-7fa38f04.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/index-85076a8c.js","assets/index-0b89a117.css"])),G=R(()=>N(()=>import("./AlertFailed-aa759850.js"),["assets/AlertFailed-aa759850.js","assets/index-85076a8c.js","assets/index-0b89a117.css"])),T=d([]);d([]);const t=d({tgl:$().format("YYYY-MM-DD"),jenis:"Pengeluaran",kategori_id:null,nominal:"",nama:""}),h=d([]),y=d({}),D=d(!0),K=d(!1),f=d(!1),A=L.params.transaksi_id,O=async s=>{try{D.value=!0;const e=await I.get(`admin/transaksi/${s}`);t.value=e.data,t.value.nominal=la.formatRupiah(e.data.nominal),await P(t.value.jenis);const o=e.data.kategori;if(!r.value&&o.id!==b.id){g.danger("Akses Ditolak","Anda tidak memiliki izin untuk mengedit transaksi non-kantor."),j.push({name:"admin-transaksi"});return}t.value.kategori_id={id:o.id,label:o.nama},D.value=!1}catch(e){D.value=!1,K.value=!0,g.danger("Warning","Data Gagal dimuat"),console.error(e)}};Z(async()=>{await O(A)});const P=async(s=t.value.jenis)=>{try{let e=[];r.value?e=(await I.get(`admin/data_kategori/jenis?jenis=${s}`)).data:(e=[{id:b.id,nama:b.label,jenis:s}],s==="Pemasukan"&&t.value.jenis),T.value=e,Y()}catch(e){g.danger("Warning","Data Kategori Gagal dimuat"),console.error(e)}},Y=()=>{h.value=T.value.map(s=>({label:s.nama,id:s.id})),!t.value.kategori_id&&h.value.length>0&&(t.value.kategori_id=h.value[0]),r.value||(t.value.kategori_id=b)},z=async()=>{t.value.jenis="Pengeluaran",r.value||(t.value.kategori_id=b),await P("Pengeluaran")},B=async()=>{if(!r.value){g.warning("Akses Dibatasi","Anda tidak dapat mengubah ke jenis Pemasukan."),t.value.jenis="Pengeluaran",await P("Pengeluaran");return}t.value.jenis="Pemasukan",await P("Pemasukan")},W=s=>{if(!t.value.kategori_id){y.value.kategori_id="Kategori harus diisi";return}if(f.value)return;y.value.kategori_id="";const e=t.value.nominal?t.value.nominal.toString().replace(/\D/g,""):"";let o={tgl:s.tgl,nama:s.nama,nominal:e,kategori_id:t.value.kategori_id.id,jenis:t.value.jenis};q(o)},q=async s=>{var e,o;console.log("Data dikirim:",s),f.value=!0;try{await I.put(`admin/transaksi/${A}`,s)&&(g.success("Info","Data berhasil diupdate!"),j.push({name:"admin-transaksi"}))}catch(n){let l="Terjadi kesalahan jaringan atau server.";(o=(e=n.response)==null?void 0:e.data)!=null&&o.message?l=n.response.data.message:n.message&&(l=n.message),g.danger("Error",l),console.error("Kesalahan saat submit:",n)}finally{f.value=!1}},H=()=>{const s=t.value.nominal.toString().replace(/\D/g,"");if(!s){t.value.nominal="";return}const e=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0});t.value.nominal=e.format(parseInt(s,10))},J=S(()=>!r.value);return(s,e)=>{const o=aa("v-select");return u(),m(ta,null,[a("div",ua,[a("div",null,[ma,a("p",ca," Mengedit Transaksi ID: **"+v(i(A))+"** (Pengguna: **"+v(V.value.username||"...")+"**) ",1)]),a("div",pa,[a("button",{onClick:e[0]||(e[0]=n=>i(j).back()),class:"btn btn-ghost"},[va,_(" Kembali ")])])]),D.value?(u(),m("span",ga,[c(i(U))])):K.value?(u(),m("span",_a,[c(i(G),{message:"Gagal mendapatkan response dari server"})])):(u(),m("span",ba,[a("div",fa,[a("div",ka,[a("a",{class:k(["tab",{"tab-active":t.value.jenis=="Pengeluaran"}]),onClick:e[1]||(e[1]=n=>z())}," ðŸ’¸ Pengeluaran ",2),a("a",{class:k(["tab",{"tab-active":t.value.jenis=="Pemasukan","tab-disabled":!r.value}]),onClick:e[2]||(e[2]=n=>B())}," ðŸ’° Pemasukan ",2)])]),t.value?(u(),m("div",xa,[a("div",ha,[a("div",ya,[c(i(oa),{onSubmit:W},{default:E(({errors:n})=>[a("div",Da,[a("div",null,[Pa,c(i(w),{rules:i(C).validateData2,modelValue:t.value.tgl,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.tgl=l),name:"tgl",type:"date",class:k(["input input-bordered w-full",{"input-error":n.tgl}])},null,8,["rules","modelValue","class"]),a("div",wa,v(n.tgl),1)]),a("div",null,[a("label",ja,[Va,r.value?F("",!0):(u(),m("span",Aa,"(Hanya Kantor)"))]),c(i(w),{modelValue:t.value.jenis,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.jenis=l),name:"jenis",type:"hidden"},null,8,["modelValue"]),c(o,{class:k(["style-chooser w-full",{"border-error":y.value.kategori_id}]),options:h.value,modelValue:t.value.kategori_id,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.kategori_id=l),clearable:r.value,disabled:J.value,placeholder:"Pilih Kategori"},null,8,["options","modelValue","clearable","disabled","class"]),a("div",Sa,v(y.value.kategori_id),1)]),a("div",null,[Ia,c(i(w),{rules:i(C).validateData2,modelValue:t.value.nominal,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.nominal=l),name:"nominal",type:"text",class:k(["input input-bordered w-full",{"input-error":n.nominal}]),onKeyup:e[7]||(e[7]=l=>H()),placeholder:"Contoh: 15.000"},null,8,["rules","modelValue","class"]),a("div",Ta,v(n.nominal),1)]),a("div",Ka,[Ea,c(i(w),{modelValue:t.value.nama,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.nama=l),name:"nama"},{default:E(({field:l})=>[a("textarea",ea(l,{class:["textarea textarea-bordered w-full h-24",{"textarea-error":n.nama}],placeholder:"Tulis keterangan transaksi di sini..."}),null,16)]),_:2},1032,["modelValue"]),a("div",Fa,v(n.nama),1)])]),a("div",Ra,[a("button",{type:"submit",class:"btn btn-primary btn-lg",disabled:f.value},[f.value?(u(),m("span",Ca,[$a,_(" Memproses... ")])):(u(),m("span",La,[Ma,_(" ðŸ’¾ Simpan Perubahan ")]))],8,Na)])]),_:1})])])])):F("",!0)]))],64)}}},Ha=da(Ua,[["__scopeId","data-v-3245f71b"]]);export{Ha as default};
