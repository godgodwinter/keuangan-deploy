import{f as J,q as Q,i as A,r as u,s as X,a as Z,o as c,c as p,b as e,t as g,u as i,g as P,e as d,n as b,w as K,j as E,v as aa,F as ea,T as v,p as ta,l as sa,m as F,_ as R}from"./index-cee19467.js";import{F as na}from"./FungsiCampur-1f52fc3b.js";import{A as I}from"./axios-526409ed.js";import{F as D,f as N,a as la}from"./babengValidasi-7b5443b8.js";import{m as C,l as oa}from"./id-c944ffbf.js";import{u as ia}from"./dataProfile-3bdee8a0.js";import{_ as ra}from"./_plugin-vue_export-helper-c27b6911.js";const m=k=>(ta("data-v-6d4d1aba"),k=k(),sa(),k),da={class:"pt-4 px-5 md:flex justify-between items-center border-b pb-4 bg-base-200"},ua=m(()=>e("h1",{class:"text-2xl sm:text-3xl font-extrabold text-base-content uppercase"}," âœï¸ EDIT TRANSAKSI ",-1)),ma={class:"text-sm text-gray-500"},ca={class:"md:py-0 py-4 space-x-2 space-y-2"},pa=m(()=>e("i",{class:"fas fa-arrow-left mr-2"},null,-1)),ga={key:0},va={key:1},_a={key:2},ba={class:"w-full py-6 flex justify-center"},ka={class:"tabs tabs-boxed bg-base-300"},fa={key:0,class:"px-4 py-4 max-w-4xl mx-auto"},xa={class:"w-full"},ya={class:"shadow-xl rounded-lg p-6 bg-base-100"},ha={class:"grid md:grid-cols-2 gap-4"},Da=m(()=>e("label",{for:"tgl",class:"label"},[e("span",{class:"label-text text-base-content"},[P("Tanggal Transaksi "),e("span",{class:"text-error"},"*")])],-1)),Pa={class:"text-xs text-error mt-1"},wa={for:"kategori",class:"label"},ja=m(()=>e("span",{class:"label-text text-base-content"},[P("Kategori "),e("span",{class:"text-error"},"*")],-1)),Va={key:0,class:"label-text-alt text-primary"},Aa={class:"text-xs text-error mt-1"},Ia=m(()=>e("label",{for:"nominal",class:"label"},[e("span",{class:"label-text text-base-content"},[P("Jumlah / Nominal (IDR) "),e("span",{class:"text-error"},"*")])],-1)),Sa={class:"text-xs text-error mt-1"},Ta={class:"md:col-span-2"},Ka=m(()=>e("label",{for:"nama",class:"label"},[e("span",{class:"label-text text-base-content"},"Keterangan")],-1)),Ea={class:"text-xs text-error mt-1"},Fa=m(()=>e("div",{class:"w-full flex justify-end mt-8"},[e("button",{type:"submit",class:"btn btn-primary btn-lg"}," ðŸ’¾ Simpan Perubahan ")],-1)),Ra={__name:"AdminTransaksiEdit",setup(k){C.updateLocale("id",oa);const w=J(),$=Q(),L=ia(),j=A(()=>L.getData),r=A(()=>j.value&&j.value.username==="admin"),_={label:"kantor",id:18},U=F(()=>R(()=>import("./AlertLoading-8fc4a207.js"),["assets/AlertLoading-8fc4a207.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/index-cee19467.js","assets/index-0b89a117.css"])),G=F(()=>R(()=>import("./AlertFailed-4036bfca.js"),["assets/AlertFailed-4036bfca.js","assets/index-cee19467.js","assets/index-0b89a117.css"])),S=u([]);u([]);const t=u({tgl:C().format("YYYY-MM-DD"),jenis:"Pengeluaran",kategori_id:null,nominal:"",nama:""}),f=u([]),x=u({}),y=u(!0),T=u(!1),V=$.params.transaksi_id,M=async s=>{try{y.value=!0;const a=await I.get(`admin/transaksi/${s}`);t.value=a.data,t.value.nominal=na.formatRupiah(a.data.nominal),await h(t.value.jenis);const o=a.data.kategori;if(!r.value&&o.id!==_.id){v.danger("Akses Ditolak","Anda tidak memiliki izin untuk mengedit transaksi non-kantor."),w.push({name:"admin-transaksi"});return}t.value.kategori_id={id:o.id,label:o.nama},y.value=!1}catch(a){y.value=!1,T.value=!0,v.danger("Warning","Data Gagal dimuat"),console.error(a)}};X(async()=>{await M(V)});const h=async(s=t.value.jenis)=>{try{let a=[];r.value?a=(await I.get(`admin/data_kategori/jenis?jenis=${s}`)).data:(a=[{id:_.id,nama:_.label,jenis:s}],s==="Pemasukan"&&t.value.jenis),S.value=a,O()}catch(a){v.danger("Warning","Data Kategori Gagal dimuat"),console.error(a)}},O=()=>{f.value=S.value.map(s=>({label:s.nama,id:s.id})),!t.value.kategori_id&&f.value.length>0&&(t.value.kategori_id=f.value[0]),r.value||(t.value.kategori_id=_)},Y=async()=>{t.value.jenis="Pengeluaran",r.value||(t.value.kategori_id=_),await h("Pengeluaran")},z=async()=>{if(!r.value){v.warning("Akses Dibatasi","Anda tidak dapat mengubah ke jenis Pemasukan."),t.value.jenis="Pengeluaran",await h("Pengeluaran");return}t.value.jenis="Pemasukan",await h("Pemasukan")},B=s=>{if(!t.value.kategori_id){x.value.kategori_id="Kategori harus diisi";return}x.value.kategori_id="";const a=t.value.nominal?t.value.nominal.toString().replace(/\D/g,""):"";let o={tgl:s.tgl,nama:s.nama,nominal:a,kategori_id:t.value.kategori_id.id,jenis:t.value.jenis};W(o)},W=async s=>{var a,o;console.log("Data dikirim:",s);try{await I.put(`admin/transaksi/${V}`,s)&&(v.success("Info","Data berhasil diupdate!"),w.push({name:"admin-transaksi"}))}catch(n){let l="Terjadi kesalahan jaringan atau server.";(o=(a=n.response)==null?void 0:a.data)!=null&&o.message?l=n.response.data.message:n.message&&(l=n.message),v.danger("Error",l),console.error("Kesalahan saat submit:",n)}},q=()=>{const s=t.value.nominal.toString().replace(/\D/g,"");if(!s){t.value.nominal="";return}const a=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0});t.value.nominal=a.format(parseInt(s,10))},H=A(()=>!r.value);return(s,a)=>{const o=Z("v-select");return c(),p(ea,null,[e("div",da,[e("div",null,[ua,e("p",ma," Mengedit Transaksi ID: **"+g(i(V))+"** (Pengguna: **"+g(j.value.username||"...")+"**) ",1)]),e("div",ca,[e("button",{onClick:a[0]||(a[0]=n=>i(w).back()),class:"btn btn-ghost"},[pa,P(" Kembali ")])])]),y.value?(c(),p("span",ga,[d(i(U))])):T.value?(c(),p("span",va,[d(i(G),{message:"Gagal mendapatkan response dari server"})])):(c(),p("span",_a,[e("div",ba,[e("div",ka,[e("a",{class:b(["tab",{"tab-active":t.value.jenis=="Pengeluaran"}]),onClick:a[1]||(a[1]=n=>Y())}," ðŸ’¸ Pengeluaran ",2),e("a",{class:b(["tab",{"tab-active":t.value.jenis=="Pemasukan","tab-disabled":!r.value}]),onClick:a[2]||(a[2]=n=>z())}," ðŸ’° Pemasukan ",2)])]),t.value?(c(),p("div",fa,[e("div",xa,[e("div",ya,[d(i(la),{onSubmit:B},{default:K(({errors:n})=>[e("div",ha,[e("div",null,[Da,d(i(D),{rules:i(N).validateData2,modelValue:t.value.tgl,"onUpdate:modelValue":a[3]||(a[3]=l=>t.value.tgl=l),name:"tgl",type:"date",class:b(["input input-bordered w-full",{"input-error":n.tgl}])},null,8,["rules","modelValue","class"]),e("div",Pa,g(n.tgl),1)]),e("div",null,[e("label",wa,[ja,r.value?E("",!0):(c(),p("span",Va,"(Hanya Kantor)"))]),d(i(D),{modelValue:t.value.jenis,"onUpdate:modelValue":a[4]||(a[4]=l=>t.value.jenis=l),name:"jenis",type:"hidden"},null,8,["modelValue"]),d(o,{class:b(["style-chooser w-full",{"border-error":x.value.kategori_id}]),options:f.value,modelValue:t.value.kategori_id,"onUpdate:modelValue":a[5]||(a[5]=l=>t.value.kategori_id=l),clearable:r.value,disabled:H.value,placeholder:"Pilih Kategori"},null,8,["options","modelValue","clearable","disabled","class"]),e("div",Aa,g(x.value.kategori_id),1)]),e("div",null,[Ia,d(i(D),{rules:i(N).validateData2,modelValue:t.value.nominal,"onUpdate:modelValue":a[6]||(a[6]=l=>t.value.nominal=l),name:"nominal",type:"text",class:b(["input input-bordered w-full",{"input-error":n.nominal}]),onKeyup:a[7]||(a[7]=l=>q()),placeholder:"Contoh: 15.000"},null,8,["rules","modelValue","class"]),e("div",Sa,g(n.nominal),1)]),e("div",Ta,[Ka,d(i(D),{modelValue:t.value.nama,"onUpdate:modelValue":a[8]||(a[8]=l=>t.value.nama=l),name:"nama"},{default:K(({field:l})=>[e("textarea",aa(l,{class:["textarea textarea-bordered w-full h-24",{"textarea-error":n.nama}],placeholder:"Tulis keterangan transaksi di sini..."}),null,16)]),_:2},1032,["modelValue"]),e("div",Ea,g(n.nama),1)])]),Fa]),_:1})])])])):E("",!0)]))],64)}}},Oa=ra(Ra,[["__scopeId","data-v-6d4d1aba"]]);export{Oa as default};
